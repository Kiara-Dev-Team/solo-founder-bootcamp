name: YC Weekly Check-in

# Simulates the weekly YC dinner where founders share updates
# Runs every Monday at 9 AM UTC
#
# NOTE: This workflow uses version tags (@v4, @v7) instead of SHA hashes
# for easier maintenance. When copying to your repo, consider pinning to
# specific SHAs for production use if you need guaranteed reproducibility.
on:
  schedule:
    - cron: '0 9 * * 1'  # Every Monday at 9 AM UTC
  workflow_dispatch:  # Allow manual trigger

permissions:
  issues: write
  contents: read

jobs:
  create-checkin:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get current date
        id: date
        run: echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

      - name: Get week number
        id: week
        run: echo "week=$(date +'%U')" >> $GITHUB_OUTPUT

      - name: Read previous metrics
        id: metrics
        run: |
          if [ -f "METRICS.md" ]; then
            echo "has_metrics=true" >> $GITHUB_OUTPUT
          else
            echo "has_metrics=false" >> $GITHUB_OUTPUT
          fi

      - name: Create weekly check-in issue
        uses: actions/github-script@v7
        with:
          script: |
            const weekNumber = '${{ steps.week.outputs.week }}';
            const date = '${{ steps.date.outputs.date }}';
            const hasMetrics = '${{ steps.metrics.outputs.has_metrics }}' === 'true';
            
            const body = `## ğŸš€ Weekly Check-in - Week ${weekNumber} (${date})

            Welcome to your weekly check-in! This simulates the YC weekly dinner where founders share updates and get feedback.

            ### ğŸ“Š What did you ship this week?
            <!-- List features, fixes, or experiments you deployed -->
            - 

            ### ğŸ“ˆ Metrics Update
            ${hasMetrics ? '<!-- Update your METRICS.md file or add numbers here -->' : ''}
            - **Weekly Active Users:** 
            - **Revenue (MRR/ARR):** 
            - **Growth Rate:** 
            - **Key Metric:** 

            ### âœ… What's working well?
            <!-- What's driving growth or engagement? -->
            - 

            ### ğŸš§ What's blocking you?
            <!-- Technical, product, or business blockers -->
            - 

            ### ğŸ¯ What are you focusing on next week?
            <!-- Top 3 priorities -->
            1. 
            2. 
            3. 

            ### ğŸ’¡ Key Learnings
            <!-- What did you learn from users or experiments this week? -->
            - 

            ### ğŸ—£ï¸ User Conversations
            <!-- How many users did you talk to? What did you learn? -->
            - **Number of conversations:** 
            - **Key insights:** 

            ---

            ### ğŸ“ Automated Insights

            **Remember YC's core advice:**
            - âœ… Make something people want
            - âœ… Talk to users (aim for 5+ conversations per week)
            - âœ… Ship fast and iterate
            - âœ… Do things that don't scale
            - âœ… Focus on one metric that matters

            **Action items:**
            - [ ] Update metrics in METRICS.md
            - [ ] Review last week's goals
            - [ ] Plan next week's priorities
            - [ ] Schedule user conversations

            ---

            *Close this issue when you've completed your check-in. Your progress is tracked automatically.*

            **Labels:** weekly-checkin, week-${weekNumber}`;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“… Weekly Check-in - Week ${weekNumber} (${date})`,
              body: body,
              labels: ['weekly-checkin', 'automation', `week-${weekNumber}`]
            });

      - name: Analyze previous week
        uses: actions/github-script@v7
        with:
          script: |
            // Get closed issues from last week
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'closed',
              since: oneWeekAgo.toISOString(),
              labels: 'weekly-checkin'
            });

            const commits = await github.rest.repos.listCommits({
              owner: context.repo.owner,
              repo: context.repo.repo,
              since: oneWeekAgo.toISOString()
            });

            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              sort: 'updated',
              direction: 'desc'
            });

            console.log(`ğŸ“Š Last week's activity:`);
            console.log(`- Check-ins completed: ${issues.data.length}`);
            console.log(`- Commits: ${commits.data.length}`);
            console.log(`- Pull requests: ${prs.data.length}`);
            
            // Provide feedback based on activity
            let feedback = [];
            
            if (commits.data.length < 10) {
              feedback.push("âš ï¸  Low commit activity. Remember to ship frequently!");
            }
            
            if (commits.data.length > 50) {
              feedback.push("ğŸš€ Great shipping velocity! Keep it up!");
            }
            
            if (feedback.length > 0) {
              console.log("\nğŸ’¡ Automated feedback:");
              feedback.forEach(f => console.log(f));
            }
